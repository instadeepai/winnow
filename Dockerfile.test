# Use a lightweight Python image with uv pre-installed
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

# Install git and clean up in single layer to reduce image size
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y --no-install-recommends git \
    && apt-get clean autoclean \
    && apt-get autoremove -y \
    && rm -rf /var/lib/{apt,dpkg,cache,log} /var/cache/apt

# Set working directory
WORKDIR /app

# Copy pyproject.toml and uv.lock for reproducible dependency installation
COPY pyproject.toml pyproject.toml
COPY uv.lock uv.lock

# Install dependencies directly from lock file
# This does not silently update the lock file, so will fail if the lock file is not up to date
RUN uv sync --frozen --no-cache --only-dev
